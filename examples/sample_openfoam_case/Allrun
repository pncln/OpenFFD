#!/bin/sh
cd ${0%/*} || exit 1    # Run from this directory

# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

echo "Running OpenFOAM CFD case generated by OpenFFD"
echo "=============================================="

# Check if mesh exists
if [ ! -d "constant/polyMesh" ]; then
    echo "ERROR: No mesh found in constant/polyMesh"
    echo "Please copy your mesh files to constant/polyMesh before running"
    exit 1
fi

# Check mesh quality
echo "Checking mesh quality..."
runApplication checkMesh

# Decompose for parallel run
if [ -f "system/decomposeParDict" ]; then
    echo "Decomposing case for parallel execution..."
    runApplication decomposePar
    
    # Run solver in parallel
    echo "Running simpleFoam in parallel..."
    runParallel simpleFoam
    
    # Reconstruct case
    echo "Reconstructing case..."
    runApplication reconstructPar
else
    # Run serial
    echo "Running simpleFoam in serial..."
    runApplication simpleFoam
fi

echo "Simulation completed!"
echo "Check the log files for convergence information."
